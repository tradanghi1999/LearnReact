<!DOCTYPE html>
<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://unpkg.com/rxjs/bundles/rxjs.umd.min.js"></script>
<script>
    var db = [
    {
        "id": 142205,
        "distances": [0,4,5,2,4,9,5,5,6,7,2,1,5,3,8,3,8],
        "timetravels":[0,0.17,0.21,0.1,0.17,0.34,0.23,0.21,0.24,0.26,0.1,0.05,0.21,0.14,0.3,0.14,0.3],
        "order": {
            "weight": 0,
            "long": 106.775174,
            "lat": 10.847981
          }
        
    },
    {
        "id": 142188,
        "distances": [4,0,3,3,8,5,1,9,3,4,6,4,2,8,1,8,4],
        "timetravels":[0.17,0,0.14,0.19,0.3,0.21,0.05,0.34,0.14,0.17,0.25,0.17,0.1,0.3,0.05,0.32,0.17],
        "order":{
            "weight": 7,
            "long": 106.77441,
            "lat": 10.841086
        }
    },
    {
        "id": 142168,
        "distances": [5,3,0,1,2,3,4,5,6,7,8,9,3,6,7,5,1],
        "timetravels":[0.21,0.14,0,0.05,0.1,0.14,0.17,0.21,0.24,0.26,0.3,0.34,0.14,0.24,0.26,0.21,0.05],
        "order":{
            "weight": 3,
            "long": 106.773538,
            "lat": 10.844492
        }
    },
    {
        "id": 142171,
        "distances": [2,3,1,0,1,4,3,7,5,6,7,8,2,5,9,2,6],
        "timetravels":[0.1,0.19,0.05,0,0.05,0.17,0.14,0.26,0.21,0.24,0.26,0.3,0.1,0.21,0.4,0.11,0.24],
        "order":{
            "weight": 10,
            "long": 106.763187,
            "lat": 10.852758
        }
    },
    {
        "id": 142173,
        "distances": [4,8,2,1,0,5,6,6,1,5,3,3,9,2,3,1,2],
        "timetravels":[0.17,0.3,0.1,0.05,0,0.21,0.26,0.24,0.09,0.21,0.14,0.14,0.34,0.1,0.14,0.07,0.1],
        "order":{
            "weight": 4,
            "long": 106.768171,
            "lat": 10.85033
        }
    },
    {
        "id": 142186,
        "distances": [9,5,3,4,5,0,7,3,2,6,7,5,3,1,6,3,4],
        "timetravels":[0.34,0.21,0.14,0.17,0.21,0,0.26,0.14,0.11,0.24,0.27,0.21,0.14,0.05,0.32,0.14,0.17],
        "order":{
            "weight": 8,
            "long": 106.770891,
            "lat": 10.849677
        }
    },
    {
        "id": 142169,
        "distances": [5,1,4,3,6,7,0,1,4,8,9,5,2,4,3,2,4],
        "timetravels":[0.23,0.05,0.17,0.14,0.26,0.26,0,0.05,0.18,0.3,0.34,0.21,0.1,0.17,0.14,0.1,0.17],
        "order":{
            "weight": 6,
      "long": 106.776231,
      "lat": 10.874757
    }
    },
    {
        "id": 142179,
        "distances": [5,9,5,7,6,3,1,0,7,1,5,4,7,8,7,4,3],
        "timetravels":[0.21,0.34,0.21,0.26,0.24,0.14,0.05,0,0.26,0.05,0.21,0.17,0.28,0.3,0.26,0.17,0.14],
        "order":{
            "weight": 5,
            "long": 106.778244,
            "lat": 10.870165
        }
    },
    {
        "id": 142198,
        "distances": [6,3,6,5,1,2,4,7,0,6,4,6,4,2,3,6,3],
        "timetravels":[0.24,0.14,0.24,0.21,0.09,0.11,0.18,0.26,0,0.24,0.17,0.24,0.17,0.12,0.16,0.24,0.14],
        "order":{
            "weight": 1,
            "long": 106.761178,
            "lat": 10.858531
        }
    },
    {
        "id": 16901,
        "distances": [7,4,7,6,5,6,8,1,6,0,9,1,5,1,2,8,5],
        "timetravels":[0.26,0.17,0.26,0.24,0.21,0.24,0.3,0.05,0.24,0,0.34,0.05,0.21,0.05,0.1,0.3,0.21],
        "order":{
            "weight": 2,
             "long": 106.763545,
             "lat": 10.856093
        }
    },
    {
        "id": 1125,
        "distances": [2,6,8,7,3,7,9,5,4,9,0,2,1,7,2,7,4],
        "timetravels":[0.1,0.25,0.3,0.26,0.14,0.27,0.34,0.21,0.17,0.34,0,0.1,0.07,0.26,0.1,0.26,0.17],
        "order":{
            "weight": 9,
            "long": 106.761683,
            "lat": 10.86049
        }
    },
    {
        "id": 3306,
        "distances": [1,4,9,8,3,5,5,4,6,1,2,0,6,5,3,9,7],
        "timetravels":[0.05,0.17,0.34,0.3,0.14,0.21,0.21,0.17,0.24,0.05,0.1,0,0.24,0.21,0.14,0.36,0.26],
        "order":{
            "weight": 3,
            "long": 106.762352,
            "lat": 10.862985
        }
    },
    {
        "id": 16058,
        "distances": [5,2,3,2,9,3,2,7,4,5,1,6,0,4,4,7,9],
        "timetravels":[0.21,0.1,0.14,0.1,0.34,0.14,0.1,0.28,0.17,0.21,0.07,0.24,0,0.17,0.17,0.26,0.44],
        "order":{
            "weight": 8,
            "long": 106.772033,
            "lat": 10.860827
        }
    },
    {
        "id": 17113,
        "distances": [3,8,6,5,2,1,4,8,2,1,7,5,4,0,6,4,2],
        "timetravels":[0.14,0.3,0.24,0.21,0.1,0.05,0.17,0.3,0.12,0.05,0.26,0.21,0.17,0,0.24,0.17,0.1],
        "order":{
            "weight": 6,
            "long": 106.772033,
            "lat": 10.860827
        }
    },
    {
        "id": 2061,
        "distances": [8,1,7,9,3,6,3,7,3,2,2,3,4,6,0,6,1],
        "timetravels":[0.3,0.05,0.26,0.4,0.14,0.32,0.14,0.26,0.16,0.1,0.1,0.14,0.17,0.24,0,0.24,0.05],
        "order":{
            "weight": 2,
      "long": 106.773386,
      "lat": 10.860449
        }
    },
    {
        "id": 11653,
        "distances": [3,8,5,2,1,3,2,4,6,8,7,9,7,4,6,0,8],
        "timetravels":[0.14,0.32,0.21,0.11,0.07,0.14,0.1,0.17,0.24,0.3,0.26,0.36,0.26,0.17,0.24,0,0.3],
        "order":{
            "weight": 7,
            "long": 106.781517,
            "lat": 10.850289
        }
    },
    {
        "id": 70445,
        "distances": [8,4,1,6,2,4,4,3,3,5,4,7,9,2,1,8,0],
        "timetravels":[0.3,0.17,0.05,0.24,0.1,0.17,0.17,0.14,0.14,0.21,0.17,0.26,0.44,0.1,0.05,0.3,0],
        "order":{
            "weight": 4,
            "long": 106.813917,
            "lat": 10.848794
        }
    }
]

let stops$ = rxjs.from(db)
.pipe(
    rxjs.operators.map(x => x.timetravels.reduce((a,b)=> a+b))
)
.subscribe(console.log)


let timetravel$ = rxjs.from(db)
.pipe(
    rxjs.operators.map(x => x.timetravels),
    rxjs.operators.toArray(),
   
)
.subscribe(
    ttArr=> {
        let times =[]
        let routePri = getRouteonTT(ttArr)
        for(let i = 0 ; i < routePri.length - 1; i++)
        {
            times.push(ttArr[routePri[i]][routePri[i+1]])
        }
        console.log(routePri)
        console.log(times)
        console.log(times.reduce((a,b)=> a+b))
    }
)


let distance$ = rxjs.from(db)
.pipe(
    rxjs.operators.map(x => x.distances),
    rxjs.operators.toArray(),
)
.subscribe(
    tdArr=>
    {
        let distances = []
        let routes = [
        0, 11,  9, 7,  6,  0, 3,
        2, 16, 14, 0, 10, 12, 1,
        8,  0, 13, 5, 15,  4, 0
        ]
        for(let i = 0 ; i < routes.length - 1; i++)
        {
            distances.push(tdArr[routes[i]][routes[i+1]])
        }
        console.log(distances)
        console.log(distances.reduce((a,b)=> a+b))
    }
)
   



function getRouteonTT(ttrArr)
{
    let customers =[]
    for(i = 0; i < ttrArr.length; i++)
    {
        customers.push(i)
    }   
    

    let path = []
    path.push(0)
    for(let arr = reducer(ttrArr, customers); 
        arr.length > 1; 
        arr = reducer(ttrArr, arr))
    {
        path.push(arr[0])
    }
    path.push(customers.filter(x => path.includes(x)==false))
    path.push(0);
    return path.flat(1);
}

function min(input) {
    if (toString.call(input) !== "[object Array]")  
    return false;
    return Math.min.apply(null, input);
}

function reducer(db, resArr)
{
    let tempArr = []
    for(let i = 0; i < db.length; i++)
    {
        tempArr.push(i)
    }
    
    let currentCus = resArr[0];
    let nextArrCusToConsider = resArr.filter(x => x != currentCus)

    let nextArrCusDisToConsider = []
    nextArrCusToConsider.forEach(e =>
        nextArrCusDisToConsider.push(db[currentCus][e])
    )


    let nextCusDistance =  min(nextArrCusDisToConsider)
    let nextCus = nextArrCusToConsider[
        nextArrCusDisToConsider.findIndex(x => x==nextCusDistance)
    ]
    nextArrCusToConsider = nextArrCusToConsider.filter(x => x!= nextCus); 
    nextArrCusToConsider.unshift(nextCus);
    return nextArrCusToConsider;
}
</script>
<body>
</body>
</html>